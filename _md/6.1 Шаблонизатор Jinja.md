# Шаблонизатор  Jinja
Изучение курса [proproprogs.ru](https://proproprogs.ru/modules/chto-eto-ispolzovanie-v-shablonah)
Проект [Jinja](https://jinja.palletsprojects.com/en/2.11.x/
)
Модуль Jinja служит для обработки шаблонов. Основные его плюсы заключаются в простоте использования и богастстве предоставляемых возомжностей для преобразования текстовых шаблонов.
```shell
pip install Jinja2
```
```python
#Jinja/ex1.py
from jinja2 import Template
 
name = "Федор"
 
tm = Template("Привет {{ name }}")
msg = tm.render(name=name)
 
print(msg)
```
Коментарии к примеру выше
1. Созадем обхект Template(шаблонг), которому передаётся строка.
2. Идёт вызов метода render из этого объекта и передаётся именованный параметр name
3. В результате метод render будет ссылаться на словарь с ключом name и значением "Федор"
Данный пример достаточно простой и его можно реализовать при помощь f-строк

Метод `render` класса Tempalte понимает следующие определения:
-   {% %} – спецификатор шаблона;
-   {{ }} – выражение для вставки конструкций Python в шаблон;
-   {# #} – блок комментариев;
-   # ## – строковый комментарий.

```python
name = "Федор"
age = 28
 
tm = Template("Мне {{a*2}} лет и зовут {{ n.upper() }}.")
msg = tm.render(a=age, n=name)
 
print(msg)
```

Пример с использованием класса
```python
class Person:
    def __init__(self, name, age):
        self.name = name
        self.age = age
per = Person("Jon", 31)
tm = Template("Мне {{p.age}} лет и зовут {{ p.name }}.")
msg = tm.render(p=per)
```

Если в классе реализовать геттры:
```python
class Person:
    def __init__(self, name, age):
        self.name = name
        self.age = age
    def getName(self):
        return self.name
    def getAge(self):
        return self.age
        
per = Person("Jon", 31)
tm = Template("Мне {{p.getAge()}} лет и зовут {{ p.getName() }}.")
msg = tm.render(p=per)

print(msg)
```

Можно обращаться с помощью словаря
```python
per = { 'name': 'Федор', 'age': 34 }
 
tm = Template("Мне {{p.age}} лет и зовут {{ p.name }}.")
# tm = Template("Мне {{p['age']}} лет и зовут {{ p['name'] }}.")
msg = tm.render(p=per)

print(msg)
```

# Экранирование и блоки  raw, for, if
Для экранирования используются специальные определения `{% raw %} … {% endraw %}`
Например:
```python
from jinja2 import Template

data = '''{% raw %}Модуль Jinja вместо
определения {{ name }}
подставляет соответствующее значение{% endraw %}'''

tm = Template(data)
msg = tm.render(name='Федор')

print(msg)
```
## Экранирование символов
При работе с текстовыми HTML-шаблонами иногда есть необходимость экранироввания некоторых символов, котоыре бразузерами воспринимаются как определение тегов:
```python
link = '''В HTML-документе ссылки определяются так: 
<a href="#">Ссылка</a>'''
 
tm = Template("{{ link }}")
msg = tm.render(link = link)
 
print(msg)
```
Чтобы увидеть определение тега  \<a\> вместо самой ссылки то можно прописать флаг `e` - escape (экранирование) `tm = Template("{{link | e}}")`
```python
link = '''В HTML-документе ссылки определяются так: 
<a href="#">Ссылка</a>'''
 
tm = Template("{{link | e}}")
msg = tm.render(link = link)
 
print(msg)
```
В модуле Jinja существует специальный класс escape, который на выходе выдает строку с экранированными символами.
```python
from jinja2 import Template
from markupsafe import escape
 
link = '''В HTML-документе ссылки определяются так: 
<a href="#">Ссылка</a>'''
 
print(escape(link))
```
## Выражение for
```python
{% for <выражение> -%}  
    <повторяемый фрагмент>  
{% endfor %}
```
Данный вид блока позволяет формировать список на основе любого итерируемого объекта, например, упорядоченного списка.
```python
from jinja2 import Template

cities = [{'id': 1, 'city': 'Москва'},
          {'id': 5, 'city': 'Тверь'},
          {'id': 7, 'city': 'Минск'},
          {'id': 8, 'city': 'Смоленск'},
          {'id': 11, 'city': 'Калуга'}]
# минут перед закрывающейся скобкой указывает удалять все переносы и пробелы после блока for и после endfor
link = '''<select name="cities">
{% for c in cities -%}
    <option value="{{c['id']}}">{{c['city']}}</option>
{% endfor -%}
</select>'''

tm = Template(link)
msg = tm.render(cities = cities)

print(msg)
```

## Выражение if
```python
{% if  <условие> %}  
    <фрагмент при истинности условия>  
{% endif %}
```

```python
from jinja2 import Template

cities = [{'id': 1, 'city': 'Москва'},
          {'id': 5, 'city': 'Тверь'},
          {'id': 7, 'city': 'Минск'},
          {'id': 8, 'city': 'Смоленск'},
          {'id': 11, 'city': 'Калуга'}]
          
link = '''<select name="cities">
{% for c in cities -%}
{% if c.id > 6 -%}
    <option value="{{c['id']}}">{{c['city']}}</option>
{%elif c.city == "Москва" -%}
    <option>{{c['city']}}</option>
{%else -%}
    {{c['city']}}
{% endif -%}
{% endfor -%}
</select>'''

tm = Template(link)
msg = tm.render(cities = cities)

print(msg)
```