Модели отвечают за хранения и оперирование данными сайта. Для этого используют СУБД, например SQLite, MySQL, PostgreSQL.
В Django встроен механизм взаимодействия с таблицами БД через объекты классов языка Python посредством технологии ORM (Object-Relational Mapping). Причем этот интерфейс универсален и на уровне WSGI-приложения не привязан к конкретной СУБД.

![[Pasted image 20220714135741.png]]
При работе с Django разработчику не нужно беспокоиться о подключении к БД и ее закрытию, когда пользователь покидает сайт. Фреймворк такие действия берет на себя и делает это весьма эффективно. Все что нам остается, это через модель взаимодействия выполнять команды API интерфейса, записывать, считывать и обновлять данные.
Django по умолчанию сконфигурирован для работы с БД SQLite. 
Настройка БД находится в файле `coolsite\coolsite\settings.py`
```python
# Словарь DATABASES определяет СУБД SQLite3 и путь к файлу БД db.sqlite3
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}
```
Для демонстрации таблиц установим приложение DBSQLiteStudio
Для windows https://sqlitestudio.pl/
Для linux
```bash
sudo apt-get update 
sudo apt-get install sqlitebrowser
```
Добавляем первую модель, первый класс, который будет описывать таблицу women для хранения информации об известных женщинах.
Структура таблица будет такой:

| women   |       |
|----------|-------------|
| id:|  integer, primare key |
| title: |    Varchar   |
| content: | Text |
| photo:|  Image |
| time_create: |    DateTime   |
| time_update: | DateTime |
| is_published: | Boolen |

Чтобы у нас в БД появилась таблица с такой структурой нам надо  объявить класс с этими полями, а затем, выполнить миграцию. 
1. Определеяем класс модели:
   `coolsite/women/models.py`
```python
class Women(models.Model):
    title = models.CharField(max_length=255)
    
    content = models.TextField(blank=True)
    photo = models.ImageField(upload_to="photos/%Y/%m/%d")
    time_create = models.DateTimeField(auto_now_add=True)
    time_update = models.DateTimeField(auto_now=True)
    is_published = models.BooleanField(default=True)
```
2. Поле ImageField хранит путь к файлу в таблице БД. Для автоматического выполнения операции загрузки графических файлов и формирования питу к нему, необходимо задать и настроить две константы: **MEDIA_ROOT** and **MEDIA_URL**
 
 `coolsite/coolsite/settings.py`
```python
import os
#...
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
MEDIA_URL = '/media/'
```
3.  В процессе отладки сайта мы сэмулируем работу реального сервера для получения ранее загруженных файлов и передачи их нашему прилоежнию.
 `coolsite/coolsite/urls.py`
```python
#...
from coolsite import settings
from django.conf.urls.static import static
#from cgitb import handler
#from women.views import *
#from django.contrib import admin
#from django.urls import path, include
#
#urlpatterns = [
#    path('admin/', admin.site.urls),
#    path('', include('women.urls')),
#    path('cats/<int:catid>/', categories),
#]

# в режиме откладки добавляем дополнительный путь для медиафайлов
if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=sttings.MEDIA_ROOT)

#handler404 = pageNotFound
```
### Создание и запуск миграций приложения
Для создания таблицы в БД на основе описанной модели в Django существует механизм, известный как создание и выполнение миграций для БД. Миграция, фактически, это модули языка Python, где описаны наборы команд на уровне ORM интерфейса, для создания таблиц определенных структур. При выполнении файла миграции в БД автоматически создаются новые или изменяются прежние таблицы, а также связи между ними.
Командой `(win_env) ~\django_first_step_selfedu\djsite\coolsite> python manage.py makemigration` создаём файл файл миграции.

Можно посмотреть SQL-запрос, который будет выполнен при использовании данной миграции, для этого необходи мо написать команду `(win_env) ~\django_first_step_selfedu\djsite\coolsite> python manage.py sqlmigrate women 0001`

Для выполнения миграций используем команду: `(win_env) ~\django_first_step_selfedu\djsite\coolsite> python manage.py migrate`